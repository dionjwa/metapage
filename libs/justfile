# https://github.com/casey/just
# Build the npm libraries: metapage, metaframe

parcel          := "node_modules/parcel-bundler/bin/cli.js"

help:
    @just --list

# Build the production distribution
build: build-npm-metaframe build-npm-metapage

# Build npm package in build/metaframe
build-npm-metaframe:
    {{parcel}} build ts/metapage/client/Metaframe.ts --out-dir build/metaframe

# Build npm package in build/metapage
build-npm-metapage:
    {{parcel}} build ts/metapage/client/Metapage.ts --out-dir build/metapage

# watch for file changes, building on change.
watch:
    {{parcel}} watch ts/metapage/client/Metaframe.ts ts/metapage/client/Metapage.ts

# Write library versions to the place where jekyll can consume:
# docs/_data/versions.yml
_versions-write-versions-to-jekyll:
	#!/usr/bin/env node
	var Versions = require(process.cwd() + '/test/versions.js');
	var fs = require('fs');
	var p = Versions.getMetapageVersions(true);
	p.then((versions) => { var out = 'versions: ' + JSON.stringify(versions); console.log('./docs/_data/versions.yml:\n' + out + '\n'); fs.writeFileSync('/docs/_data/versions.yml', out + '\n')});
