parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"yQaM":[function(require,module,exports) {
"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function n(){e(this,n),this._events={}}return t(n,[{key:"on",value:function(e,n){return this.addEventListener(e,n)}},{key:"isListeners",value:function(e){return!!this._events.hasOwnProperty(e)&&this._events[e].length>0}},{key:"addEventListener",value:function(e,n){return this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events._events[e].push(n),removeEventListener.bind(e,n)}},{key:"once",value:function(e,n){var t;return t=function(){var r=arguments;removeEventListener(e,t),n.apply(null,r)},this.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,n){if(e in this._events){var t=this._events[e],r=t.indexOf(n);r>-1&&t.splice(r,1)}}},{key:"emit",value:function(e,n,t,r,i){var s=[].slice.call(arguments,1);this._events.hasOwnProperty(e)&&this._events[e].slice(0).forEach(function(e){return e.apply(null,s)})}},{key:"dispose",value:function(){this._events={}}}]),n}();exports.EventEmitter=r;
},{}],"FT5O":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"Diwz":[function(require,module,exports) {
var process = require("process");
var r=require("process");function t(r,t){for(var e=0,n=r.length-1;n>=0;n--){var o=r[n];"."===o?r.splice(n,1):".."===o?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function e(r){"string"!=typeof r&&(r+="");var t,e=0,n=-1,o=!0;for(t=r.length-1;t>=0;--t)if(47===r.charCodeAt(t)){if(!o){e=t+1;break}}else-1===n&&(o=!1,n=t+1);return-1===n?"":r.slice(e,n)}function n(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}exports.resolve=function(){for(var e="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var i=s>=0?arguments[s]:r.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,o="/"===i.charAt(0))}return(o?"/":"")+(e=t(n(e.split("/"),function(r){return!!r}),!o).join("/"))||"."},exports.normalize=function(r){var e=exports.isAbsolute(r),s="/"===o(r,-1);return(r=t(n(r.split("/"),function(r){return!!r}),!e).join("/"))||e||(r="."),r&&s&&(r+="/"),(e?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(n(r,function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),o=e(t.split("/")),s=Math.min(n.length,o.length),i=s,u=0;u<s;u++)if(n[u]!==o[u]){i=u;break}var f=[];for(u=i;u<n.length;u++)f.push("..");return(f=f.concat(o.slice(i))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){if("string"!=typeof r&&(r+=""),0===r.length)return".";for(var t=r.charCodeAt(0),e=47===t,n=-1,o=!0,s=r.length-1;s>=1;--s)if(47===(t=r.charCodeAt(s))){if(!o){n=s;break}}else o=!1;return-1===n?e?"/":".":e&&1===n?"/":r.slice(0,n)},exports.basename=function(r,t){var n=e(r);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},exports.extname=function(r){"string"!=typeof r&&(r+="");for(var t=-1,e=0,n=-1,o=!0,s=0,i=r.length-1;i>=0;--i){var u=r.charCodeAt(i);if(47!==u)-1===n&&(o=!1,n=i+1),46===u?-1===t?t=i:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){e=i+1;break}}return-1===t||-1===n||0===s||1===s&&t===n-1&&t===e+1?"":r.slice(t,n)};var o="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};
},{"process":"FT5O"}],"L82N":[function(require,module,exports) {
module.exports=function(t,o){for(var a=[],e=0;e<t.length;e++){var n=o(t[e],e);r(n)?a.push.apply(a,n):a.push(n)}return a};var r=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)};
},{}],"LMsv":[function(require,module,exports) {
"use strict";function e(e,r,i){e instanceof RegExp&&(e=n(e,i)),r instanceof RegExp&&(r=n(r,i));var o=t(e,r,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+e.length,o[1]),post:i.slice(o[1]+r.length)}}function n(e,n){var t=n.match(e);return t?t[0]:null}function t(e,n,t){var r,i,o,f,l,s=t.indexOf(e),c=t.indexOf(n,s+1),p=s;if(s>=0&&c>0){for(r=[],o=t.length;p>=0&&!l;)p==s?(r.push(p),s=t.indexOf(e,p+1)):1==r.length?l=[r.pop(),c]:((i=r.pop())<o&&(o=i,f=c),c=t.indexOf(n,p+1)),p=s<c&&s>=0?s:c;r.length&&(l=[o,f])}return l}module.exports=e,e.range=t;
},{}],"qiWE":[function(require,module,exports) {
var t=require("concat-map"),r=require("balanced-match");module.exports=f;var n="\0SLASH"+Math.random()+"\0",e="\0OPEN"+Math.random()+"\0",i="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",a="\0PERIOD"+Math.random()+"\0";function s(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function p(t){return t.split("\\\\").join(n).split("\\{").join(e).split("\\}").join(i).split("\\,").join(o).split("\\.").join(a)}function u(t){return t.split(n).join("\\").split(e).join("{").split(i).join("}").split(o).join(",").split(a).join(".")}function l(t){if(!t)return[""];var n=[],e=r("{","}",t);if(!e)return t.split(",");var i=e.pre,o=e.body,a=e.post,s=i.split(",");s[s.length-1]+="{"+o+"}";var p=l(a);return a.length&&(s[s.length-1]+=p.shift(),s.push.apply(s,p)),n.push.apply(n,s),n}function f(t){return t?("{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2)),m(p(t),!0).map(u)):[]}function h(t){return t}function d(t){return"{"+t+"}"}function c(t){return/^-?0\d/.test(t)}function v(t,r){return t<=r}function g(t,r){return t>=r}function m(n,e){var o=[],a=r("{","}",n);if(!a||/\$$/.test(a.pre))return[n];var p,u=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(a.body),f=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(a.body),h=u||f,b=a.body.indexOf(",")>=0;if(!h&&!b)return a.post.match(/,.*\}/)?m(n=a.pre+"{"+a.body+i+a.post):[n];if(h)p=a.body.split(/\.\./);else if(1===(p=l(a.body)).length&&1===(p=m(p[0],!1).map(d)).length)return(M=a.post.length?m(a.post,!1):[""]).map(function(t){return a.pre+p[0]+t});var j,y=a.pre,M=a.post.length?m(a.post,!1):[""];if(h){var A=s(p[0]),C=s(p[1]),O=Math.max(p[0].length,p[1].length),S=3==p.length?Math.abs(s(p[2])):1,$=v;C<A&&(S*=-1,$=g);var x=p.some(c);j=[];for(var E=A;$(E,C);E+=S){var I;if(f)"\\"===(I=String.fromCharCode(E))&&(I="");else if(I=String(E),x){var q=O-I.length;if(q>0){var z=new Array(q+1).join("0");I=E<0?"-"+z+I.slice(1):z+I}}j.push(I)}}else j=t(p,function(t){return m(t,!1)});for(var L=0;L<j.length;L++)for(var P=0;P<M.length;P++){var Z=y+j[L]+M[P];(!e||h||Z)&&o.push(Z)}return o}
},{"concat-map":"L82N","balanced-match":"LMsv"}],"N4jv":[function(require,module,exports) {
module.exports=g,g.Minimatch=l;var t={sep:"/"};try{t=require("path")}catch(O){}var e=g.GLOBSTAR=l.GLOBSTAR={},n=require("brace-expansion"),r={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},i="[^/]",s=i+"*?",a="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",o="(?:(?!(?:\\/|^)\\.).)*?",h=c("().*{}+?[]^$\\!");function c(t){return t.split("").reduce(function(t,e){return t[e]=!0,t},{})}var u=/\/+/;function p(t,e){return e=e||{},function(n,r,i){return g(n,t,e)}}function f(t,e){t=t||{},e=e||{};var n={};return Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function g(t,e,n){if("string"!=typeof e)throw new TypeError("glob pattern string required");return n||(n={}),!(!n.nocomment&&"#"===e.charAt(0))&&(""===e.trim()?""===t:new l(e,n).match(t))}function l(e,n){if(!(this instanceof l))return new l(e,n);if("string"!=typeof e)throw new TypeError("glob pattern string required");n||(n={}),e=e.trim(),"/"!==t.sep&&(e=e.split(t.sep).join("/")),this.options=n,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function d(){if(!this._made){var t=this.pattern,e=this.options;if(e.nocomment||"#"!==t.charAt(0))if(t){this.parseNegate();var n=this.globSet=this.braceExpand();e.debug&&(this.debug=console.error),this.debug(this.pattern,n),n=this.globParts=n.map(function(t){return t.split(u)}),this.debug(this.pattern,n),n=n.map(function(t,e,n){return t.map(this.parse,this)},this),this.debug(this.pattern,n),n=n.filter(function(t){return-1===t.indexOf(!1)}),this.debug(this.pattern,n),this.set=n}else this.empty=!0;else this.comment=!0}}function b(){var t=this.pattern,e=!1,n=0;if(!this.options.nonegate){for(var r=0,i=t.length;r<i&&"!"===t.charAt(r);r++)e=!e,n++;n&&(this.pattern=t.substr(n)),this.negate=e}}function m(t,e){if(e||(e=this instanceof l?this.options:{}),void 0===(t=void 0===t?this.pattern:t))throw new TypeError("undefined pattern");return e.nobrace||!t.match(/\{.*\}/)?[t]:n(t)}g.filter=p,g.defaults=function(t){if(!t||!Object.keys(t).length)return g;var e=g,n=function(n,r,i){return e.minimatch(n,r,f(t,i))};return n.Minimatch=function(n,r){return new e.Minimatch(n,f(t,r))},n},l.defaults=function(t){return t&&Object.keys(t).length?g.defaults(t).Minimatch:l},l.prototype.debug=function(){},l.prototype.make=d,l.prototype.parseNegate=b,g.braceExpand=function(t,e){return m(t,e)},l.prototype.braceExpand=m,l.prototype.parse=y;var v={};function y(t,n){if(t.length>65536)throw new TypeError("pattern is too long");var a=this.options;if(!a.noglobstar&&"**"===t)return e;if(""===t)return"";var o,c="",u=!!a.nocase,p=!1,f=[],g=[],l=!1,d=-1,b=-1,m="."===t.charAt(0)?"":a.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",y=this;function w(){if(o){switch(o){case"*":c+=s,u=!0;break;case"?":c+=i,u=!0;break;default:c+="\\"+o}y.debug("clearStateChar %j %j",o,c),o=!1}}for(var x,j=0,k=t.length;j<k&&(x=t.charAt(j));j++)if(this.debug("%s\t%s %s %j",t,j,c,x),p&&h[x])c+="\\"+x,p=!1;else switch(x){case"/":return!1;case"\\":w(),p=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",t,j,c,x),l){this.debug("  in class"),"!"===x&&j===b+1&&(x="^"),c+=x;continue}y.debug("call clearStateChar %j",o),w(),o=x,a.noext&&w();continue;case"(":if(l){c+="(";continue}if(!o){c+="\\(";continue}f.push({type:o,start:j-1,reStart:c.length,open:r[o].open,close:r[o].close}),c+="!"===o?"(?:(?!(?:":"(?:",this.debug("plType %j %j",o,c),o=!1;continue;case")":if(l||!f.length){c+="\\)";continue}w(),u=!0;var A=f.pop();c+=A.close,"!"===A.type&&g.push(A),A.reEnd=c.length;continue;case"|":if(l||!f.length||p){c+="\\|",p=!1;continue}w(),c+="|";continue;case"[":if(w(),l){c+="\\"+x;continue}l=!0,b=j,d=c.length,c+=x;continue;case"]":if(j===b+1||!l){c+="\\"+x,p=!1;continue}if(l){var S=t.substring(b+1,j);try{RegExp("["+S+"]")}catch(O){var $=this.parse(S,v);c=c.substr(0,d)+"\\["+$[0]+"\\]",u=u||$[1],l=!1;continue}}u=!0,l=!1,c+=x;continue;default:w(),p?p=!1:!h[x]||"^"===x&&l||(c+="\\"),c+=x}for(l&&(S=t.substr(b+1),$=this.parse(S,v),c=c.substr(0,d)+"\\["+$[0],u=u||$[1]),A=f.pop();A;A=f.pop()){var R=c.slice(A.reStart+A.open.length);this.debug("setting tail",c,A),R=R.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(t,e,n){return n||(n="\\"),e+e+n+"|"}),this.debug("tail=%j\n   %s",R,R,A,c);var T="*"===A.type?s:"?"===A.type?i:"\\"+A.type;u=!0,c=c.slice(0,A.reStart)+T+"\\("+R}w(),p&&(c+="\\\\");var C=!1;switch(c.charAt(0)){case".":case"[":case"(":C=!0}for(var L=g.length-1;L>-1;L--){var q=g[L],B=c.slice(0,q.reStart),M=c.slice(q.reStart,q.reEnd-8),N=c.slice(q.reEnd-8,q.reEnd),_=c.slice(q.reEnd);N+=_;var G=B.split("(").length-1,P=_;for(j=0;j<G;j++)P=P.replace(/\)[+*?]?/,"");var z="";""===(_=P)&&n!==v&&(z="$"),c=B+M+_+z+N}if(""!==c&&u&&(c="(?=.)"+c),C&&(c=m+c),n===v)return[c,u];if(!u)return E(t);var D=a.nocase?"i":"";try{var F=new RegExp("^"+c+"$",D)}catch(O){return new RegExp("$.")}return F._glob=t,F._src=c,F}function w(){if(this.regexp||!1===this.regexp)return this.regexp;var t=this.set;if(!t.length)return this.regexp=!1,this.regexp;var n=this.options,r=n.noglobstar?s:n.dot?a:o,i=n.nocase?"i":"",h=t.map(function(t){return t.map(function(t){return t===e?r:"string"==typeof t?j(t):t._src}).join("\\/")}).join("|");h="^(?:"+h+")$",this.negate&&(h="^(?!"+h+").*$");try{this.regexp=new RegExp(h,i)}catch(c){this.regexp=!1}return this.regexp}function x(e,n){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&n)return!0;var r=this.options;"/"!==t.sep&&(e=e.split(t.sep).join("/")),e=e.split(u),this.debug(this.pattern,"split",e);var i,s,a=this.set;for(this.debug(this.pattern,"set",a),s=e.length-1;s>=0&&!(i=e[s]);s--);for(s=0;s<a.length;s++){var o=a[s],h=e;if(r.matchBase&&1===o.length&&(h=[i]),this.matchOne(h,o,n))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}function E(t){return t.replace(/\\(.)/g,"$1")}function j(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}g.makeRe=function(t,e){return new l(t,e||{}).makeRe()},l.prototype.makeRe=w,g.match=function(t,e,n){var r=new l(e,n=n||{});return t=t.filter(function(t){return r.match(t)}),r.options.nonull&&!t.length&&t.push(e),t},l.prototype.match=x,l.prototype.matchOne=function(t,n,r){var i=this.options;this.debug("matchOne",{this:this,file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var s=0,a=0,o=t.length,h=n.length;s<o&&a<h;s++,a++){this.debug("matchOne loop");var c,u=n[a],p=t[s];if(this.debug(n,u,p),!1===u)return!1;if(u===e){this.debug("GLOBSTAR",[n,u,p]);var f=s,g=a+1;if(g===h){for(this.debug("** at the end");s<o;s++)if("."===t[s]||".."===t[s]||!i.dot&&"."===t[s].charAt(0))return!1;return!0}for(;f<o;){var l=t[f];if(this.debug("\nglobstar while",t,f,n,g,l),this.matchOne(t.slice(f),n.slice(g),r))return this.debug("globstar found match!",f,o,l),!0;if("."===l||".."===l||!i.dot&&"."===l.charAt(0)){this.debug("dot detected!",t,f,n,g);break}this.debug("globstar swallow a segment, and continue"),f++}return!(!r||(this.debug("\n>>> no match, partial?",t,f,n,g),f!==o))}if("string"==typeof u?(c=i.nocase?p.toLowerCase()===u.toLowerCase():p===u,this.debug("string match",u,p,c)):(c=p.match(u),this.debug("pattern match",u,p,c)),!c)return!1}if(s===o&&a===h)return!0;if(s===o)return r;if(a===h)return s===o-1&&""===t[s];throw new Error("wtf?")};
},{"path":"Diwz","brace-expansion":"qiWE"}],"ckaR":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e.V0_0_1="0.0.1",e.V0_1_0="0.1.0",e.V0_2="0.2",e.V0_3="0.3"}(e=exports.Versions||(exports.Versions={})),exports.AllVersions=Object.keys(e),exports.CurrentVersion=e.V0_3;
},{}],"wx8G":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./MetaLibsVersion");exports.METAFRAME_JSON_FILE="metaframe.json",exports.METAPAGE_KEY_DEFINITION="metapage/definition",exports.METAPAGE_KEY_STATE="metapage/state",exports.URL_PARAM_DEBUG="MP_DEBUG",exports.VERSION=e.AllVersions[e.AllVersions.length-1];
},{"./MetaLibsVersion":"ckaR"}],"jmpc":[function(require,module,exports) {
"use strict";var e,t,s,p;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e.InputsUpdate="InputsUpdate",e.OutputsUpdate="OutputsUpdate",e.SetupIframeClientRequest="SetupIframeClientRequest",e.SetupIframeServerResponseAck="SetupIframeServerResponseAck",e.PluginRequest="SetupIframeServerPluginRequestResponseAck"}(e=exports.JsonRpcMethodsFromChild||(exports.JsonRpcMethodsFromChild={})),function(e){e.InputsUpdate="InputsUpdate",e.MessageAck="MessageAck",e.SetupIframeServerResponse="SetupIframeServerResponse"}(t=exports.JsonRpcMethodsFromParent||(exports.JsonRpcMethodsFromParent={})),function(e){e.Message="Message"}(s=exports.OtherEvents||(exports.OtherEvents={})),function(e){e.State="metapage/state"}(p=exports.ApiPayloadPluginRequestMethod||(exports.ApiPayloadPluginRequestMethod={}));
},{}],"pQZc":[function(require,module,exports) {
var define;
var r;!function(e,t){"function"==typeof r&&r.amd?r([],t):"object"==typeof exports?module.exports=t():e.compareVersions=t()}(this,function(){var r=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function e(r){var e,t,n=r.replace(/^v/,"").replace(/\+.*$/,""),i=(t="-",-1===(e=n).indexOf(t)?e.length:e.indexOf(t)),o=n.substring(0,i).split(".");return o.push(n.substring(i+1)),o}function t(r){return isNaN(Number(r))?r:Number(r)}function n(e){if("string"!=typeof e)throw new TypeError("Invalid argument expected string");if(!r.test(e))throw new Error("Invalid argument not valid semver ('"+e+"' received)")}function i(r,i){[r,i].forEach(n);for(var o=e(r),f=e(i),a=0;a<Math.max(o.length-1,f.length-1);a++){var u=parseInt(o[a]||0,10),p=parseInt(f[a]||0,10);if(u>p)return 1;if(p>u)return-1}var s=o[o.length-1],d=f[f.length-1];if(s&&d){var v=s.split(".").map(t),c=d.split(".").map(t);for(a=0;a<Math.max(v.length,c.length);a++){if(void 0===v[a]||"string"==typeof c[a]&&"number"==typeof v[a])return-1;if(void 0===c[a]||"string"==typeof v[a]&&"number"==typeof c[a])return 1;if(v[a]>c[a])return 1;if(c[a]>v[a])return-1}}else if(s||d)return s?-1:1;return 0}var o=[">",">=","=","<","<="],f={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.validate=function(e){return"string"==typeof e&&r.test(e)},i.compare=function(r,e,t){!function(r){if("string"!=typeof r)throw new TypeError("Invalid operator type, expected string but got "+typeof r);if(-1===o.indexOf(r))throw new TypeError("Invalid operator, expected one of "+o.join("|"))}(t);var n=i(r,e);return f[t].indexOf(n)>-1},i});
},{}],"f0H1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("compare-versions")),n=require("../Constants"),t=require("../MetaLibsVersion");exports.convertToCurrentDefinition=function(e){if(null===e)throw"Metapage definition cannot be null";if("string"==typeof e)try{e=JSON.parse(e)}catch(n){throw"Cannot parse into JSON:\n${def}"}var r;switch(exports.getMatchingVersion(e.version)){case t.Versions.V0_2:r=exports.convertToCurrentDefinition(o(e));break;case t.Versions.V0_3:r=e;break;default:throw"Unknown metapage version: ".concat(e.version,". Supported versions: [").concat(t.AllVersions.join(", "),"]")}return r};var o=function(e){return e.version=t.Versions.V0_3,e};exports.merge=function(e,r){if(!r)return!1;var n=!1;return Object.keys(r).forEach(function(t){n=!0,void 0===r[t]?delete e[t]:e[t]=r[t]}),n},exports.getMatchingVersion=function(e){return"latest"==e?t.CurrentVersion:r.default(e,"0.0.x")<=0?t.Versions.V0_0_1:r.default(e,"0.1.36")>=0&&r.default(e,t.Versions.V0_2)<0?t.Versions.V0_1_0:r.default(e,"0.2")>=0&&r.default(e,t.Versions.V0_3)<0?t.Versions.V0_2:r.default(e,"0.3")>=0?t.Versions.V0_3:(console.log("Could not match version=${version} to any known version, assuming ${Metapage.version}"),t.CurrentVersion)},exports.getUrlParam=function(e){return new URLSearchParams(window.location.search).get(e)},exports.getUrlParamDEBUG=function(){return new URLSearchParams(window.location.search).has(n.URL_PARAM_DEBUG)},exports.existsAnyUrlParam=function(e){return e.filter(function(e){return new URLSearchParams(window.location.search).has(e)}).length>0},exports.generateMetaframeId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return exports.generateId(e)},exports.generateMetapageId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return exports.generateId(e)},exports.generateNonce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return exports.generateId(e)};var s="abcdefghijklmnopqrstuvwxyz0123456789";exports.generateId=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,r="",n=s.length,t=0;t<e;t++)r+=s.charAt(Math.floor(Math.random()*n));return r},exports.log=function(e,r,n){var t;if(null!=(r=null!=r?r:"000")&&""==r.trim()&&(r=null),t="string"==typeof e?e:"number"==typeof e?e+"":JSON.stringify(e,null,"  "),null!=r&&""!=r.trim()){var o="color: #$color";null!=n&&(o="$cssstring; background: #$backgroundColor"),t="%c$s",window.console.log(t,o)}else window.console.log(t)},exports.stringToRgb=function(e){return exports.intToRGB(exports.hashCode(e))},exports.hashCode=function(e){for(var r=0,n=0;n<e.length;n++)r=e.charCodeAt(n)+((r<<5)-r);return r},exports.intToRGB=function(e){var r=(16777215&e).toString(16).toUpperCase();return"00000".substring(0,6-r.length)+r};
},{"compare-versions":"pQZc","../Constants":"wx8G","../MetaLibsVersion":"ckaR"}],"Vntl":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}function n(t,e,s){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,s){var i=a(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(s):n.value}})(t,e,s||t)}function a(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){return function(){var e,s=c(t);if(h()){var i=c(this).constructor;e=Reflect.construct(s,arguments,i)}else e=s.apply(this,arguments);return l(this,e)}}function l(e,s){return!s||"object"!==t(s)&&"function"!=typeof s?f(e):s}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(n,a){function r(t){try{o(i.next(t))}catch(e){a(e)}}function u(t){try{o(i.throw(t))}catch(e){a(e)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(r,u)}o((i=i.apply(t,e||[])).next())})},m=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e};Object.defineProperty(exports,"__esModule",{value:!0});var d,g,_=require("./EventEmitter"),v=m(require("minimatch")),y=require("../Constants"),I=require("../MetaLibsVersion"),b=require("../v0_3/JsonRpcMethods"),k=require("./MetapageTools");!function(t){t.Inputs="inputs",t.Outputs="outputs",t.State="state",t.Definition="definition",t.Error="error"}(d=exports.MetapageEvents||(exports.MetapageEvents={})),function(t){t.all="all",t.delta="delta"}(g=exports.MetapageEventStateType||(exports.MetapageEventStateType={}));var E=function(){return{metaframes:{inputs:{},outputs:{}},plugins:{inputs:{},outputs:{}}}};exports.getLibraryVersionMatching=function(t){return k.getMatchingVersion(t)};var M="bcbcbc",O=function(s){r(u,_.EventEmitter);var a=o(u);function u(t){var s;return e(this,u),(s=a.call(this))._state=E(),s._metaframes={},s._plugins={},s._pluginOrder=[],s.debug=!1,s._cachedInputLookupMap={},s._inputMap={},s._id=null!=t&&null!=t.id?t.id:k.generateMetapageId(),s._consoleBackgroundColor=null!=t&&null!=t.color?t.color:M,s.onMessage=s.onMessage.bind(f(s)),window.addEventListener("message",s.onMessage),s.log("Initialized"),s}return i(u,[{key:"setDebugFromUrlParams",value:function(){return this.debug=k.existsAnyUrlParam(["MP_DEBUG","DEBUG","debug","mp_debug"]),this}},{key:"getState",value:function(){return this._state}},{key:"onState",value:function(t){var e=this.addEventListener(d.State,t);return t(this._state),e}},{key:"setState",value:function(t){var e=this;this._state=t,this.getMetaframeIds().forEach(function(t){e.getMetaframe(t).setInputs(e._state.metaframes.inputs[t]),e.getMetaframe(t).setOutputs(e._state.metaframes.outputs[t])}),this.getPluginIds().forEach(function(t){e.getPlugin(t).setInputs(e._state.plugins.inputs[t]),e.getPlugin(t).setOutputs(e._state.plugins.outputs[t])}),this.emit(d.State,this._state)}},{key:"getStateMetaframes",value:function(){return this._state.metaframes}},{key:"getStatePlugins",value:function(){return this._state.metaframes}},{key:"getDefinition",value:function(){return this._definition}},{key:"setDefinition",value:function(e,s){var i=this,n=k.convertToCurrentDefinition(e);null!=n.metaframes&&Object.keys(n.metaframes).forEach(function(e){if(n.plugins&&n.plugins.includes(e))throw i.emitErrorMessage("Plugin with url=".concat(e," matches metaframe. Metaframe ids and plugin urls are not allowed to collide")),"Plugin with url=".concat(e," matches metaframe. Metaframe ids and plugin urls are not allowed to collide");var s=n.metaframes[e];if("object"!==t(s))throw i.emitErrorMessage('Metaframe "'.concat(e,'" is not an object')),'Metaframe "'.concat(e,'" is not an object');if(!s.url)throw i.emitErrorMessage('Metaframe "'.concat(e,'" missing field: url')),'Metaframe "'.concat(e,'" missing field: url')}),this._definition=n,Object.keys(this._metaframes).forEach(function(t){i._definition.metaframes&&i._definition.metaframes[t]||i.removeMetaframe(t)}),Object.keys(this._plugins).forEach(function(t){i._definition.plugins.includes(t)||i.removePlugin(t)}),this._pluginOrder=null!=this._definition.plugins?this._definition.plugins:[],null!=s&&(this._state=s),null!=this._definition.metaframes&&Object.keys(this._definition.metaframes).forEach(function(t){if(!i._metaframes.hasOwnProperty(t)){var e=i._definition.metaframes[t];i.addMetaframe(t,e)}}),null!=this._definition.plugins&&this._definition.plugins.forEach(function(t){i._plugins.hasOwnProperty(t)||i.addPlugin(t)});var a={definition:this._definition,metaframes:this._metaframes,plugins:this._plugins};return window.setTimeout(function(){i.emit(d.Definition,a),null!=s&&i.emit(d.State,i._state)},0),this}},{key:"addPipe",value:function(t,e){this._inputMap[t]||(this._inputMap[t]=[]),this._inputMap[t].push(e)}},{key:"removeMetaframe",value:function(t){var e=this;this._metaframes[t]&&(this._metaframes[t].dispose(),delete this._metaframes[t],delete this._state.metaframes.inputs[t],delete this._state.metaframes.outputs[t],delete this._inputMap[t],Object.keys(this._inputMap).forEach(function(s){for(var i=e._inputMap[s],n=0;n<=i.length;)i[n].metaframe==t?i.splice(n,1):n++}),this._cachedInputLookupMap={})}},{key:"removePlugin",value:function(t){this._plugins[t]&&(this._plugins[t].dispose(),delete this._plugins[t],delete this._state.plugins.inputs[t],delete this._state.plugins.outputs[t])}},{key:"removeAll",value:function(){var t=this;Object.keys(this._metaframes).forEach(function(e){return t._metaframes[e].dispose()}),Object.keys(this._plugins).forEach(function(e){return t._plugins[e].dispose()}),this._metaframes={},this._plugins={},this._state=E(),this._inputMap={},this._cachedInputLookupMap={}}},{key:"metaframes",value:function(){return this.getMetaframes()}},{key:"metaframeIds",value:function(){return this.getMetaframeIds()}},{key:"getMetaframeIds",value:function(){return Object.keys(this._metaframes)}},{key:"getMetaframes",value:function(){return Object.assign({},this._metaframes)}},{key:"plugins",value:function(){return Object.assign({},this._plugins)}},{key:"pluginIds",value:function(){return this.getPluginIds()}},{key:"getPluginIds",value:function(){return this._pluginOrder.slice(0)}},{key:"getMetaframe",value:function(t){return this._metaframes[t]}},{key:"getPlugin",value:function(t){return this._plugins[t]}},{key:"addMetaframe",value:function(t,e){var s=this;if(!t)throw"addMetaframe missing metaframeId";if(!e)throw"addMetaframe missing definition";if(this._metaframes[t])throw this.emitErrorMessage("Existing metaframe for id=".concat(t)),"Existing metaframe for id=".concat(t);if(!e.url)throw this.emitErrorMessage("Metaframe definition missing url id=".concat(t)),"Metaframe definition missing url id=".concat(t);var i=new w(e.url,t,this._id,this._consoleBackgroundColor,this.debug).setMetapage(this);return this._metaframes[t]=i,null!=e.inputs&&e.inputs.forEach(function(e){return s.addPipe(t,e)}),i.setInputs(this._state.metaframes.inputs[t]),i}},{key:"addPlugin",value:function(t){if(!t)throw"Plugin missing url";var e=new w(t,t,this._id,this._consoleBackgroundColor,this.debug).setInputs(this._state.plugins.inputs[t]).setMetapage(this).setPlugin();return this._plugins[t]=e,e}},{key:"dispose",value:function(){var t=this;n(c(u.prototype),"dispose",this).call(this),window.removeEventListener("message",this.onMessage),Object.keys(this._metaframes).forEach(function(e){return t._metaframes[e].dispose()}),Object.keys(this._plugins).forEach(function(e){return t._plugins[e].dispose()}),this._id=null,this._metaframes=null,this._plugins=null,this._state=null,this._definition=null,this._cachedInputLookupMap=null,this._inputMap=null}},{key:"log",value:function(t,e,s){this.debug&&this.logInternal(t,e,s)}},{key:"error",value:function(t){this.logInternal(t,"f00",this._consoleBackgroundColor),this.emitErrorMessage("".concat(t))}},{key:"emitErrorMessage",value:function(t){this.emit(d.Error,t)}},{key:"getInputsFromOutput",value:function(t,e){var s=this;if(this._cachedInputLookupMap[t]||(this._cachedInputLookupMap[t]={}),!this._cachedInputLookupMap[t][e]){var i=[];this._cachedInputLookupMap[t][e]=i,Object.keys(this._inputMap).forEach(function(n){n!==t&&s._inputMap[n].forEach(function(s){if(s.metaframe==t&&v(e,s.source)){var a=s.target;s.target&&!s.target.startsWith("*")&&""!==s.target||(a=e),i.push({metaframe:n,pipe:a})}})})}return this._cachedInputLookupMap[t][e]}},{key:"isValidJSONRpcMessage",value:function(t){if("2.0"!==t.jsonrpc)return!1;switch(t.method){case b.JsonRpcMethodsFromChild.SetupIframeClientRequest:return!0;default:var e=t.iframeId;return!(t.parentId!==this._id||!this._metaframes[e]&&!this._plugins[e])||(this.error("message.parentId=".concat(t.parentId," this._id=").concat(this._id," message.iframeId=").concat(e," this._metaframes.exists(message.iframeId)=").concat(void 0!==this._metaframes[e]," this._plugins.exists(message.iframeId)=").concat(void 0!==this._plugins[e]," message=").concat(JSON.stringify(t).substr(0,200))),!1)}}},{key:"setInput",value:function(t,e,s){this.setInputStateOnly(t,e,s),this.setMetaframeClientInputAndSentClientEvent(t,e,s),this.emit(d.State,this._state)}},{key:"setMetaframeClientInputAndSentClientEvent",value:function(e,s,i){var n=this;if("object"===t(e)){if(s||i)throw"bad arguments, see API docs";var a=e;Object.keys(a).forEach(function(e){var s=e,i=a[s];if("object"!==t(i))throw"bad arguments, see API docs";var r=n._metaframes[s];null!=r?r.setInputs(i):n.error("No iframe id=$metaframeId")})}else{if("string"!=typeof e)throw"bad arguments, see API docs";var r=this._metaframes[e];if(null==r&&this.error("No iframe id=".concat(e)),"string"==typeof s)r.setInput(s,i);else{if("object"!==t(s))throw"bad arguments, see API docs";r.setInputs(s)}}}},{key:"setInputs",value:function(t,e,s){this.setInput(t,e,s)}},{key:"setOutputStateOnly",value:function(t,e,s){this._setStateOnly(!1,t,e,s)}},{key:"setInputStateOnly",value:function(t,e,s){this._setStateOnly(!0,t,e,s)}},{key:"_setStateOnly",value:function(e,s,i,n){var a=this;if("object"===t(s)){if(i||n)throw"If first argument is an object, subsequent args should be undefined";var r=s;Object.keys(r).forEach(function(s){var i=r[s];if("object"!==t(i))throw"Object values must be objects";var n=a._metaframes.hasOwnProperty(s);if(!n&&!a._plugins.hasOwnProperty(s))throw"No metaframe or plugin: ${metaframeId}";var u=n?e?a._state.metaframes.inputs:a._state.metaframes.outputs:e?a._state.plugins.inputs:a._state.plugins.outputs;u[s]=null!=u[s]?u[s]:{},Object.keys(i).forEach(function(t){void 0===i[t]?delete u[s][t]:u[s][t]=i[t]})})}else{if("string"!=typeof s)throw"First argument must be a string or an object";var u=s,o=this._metaframes.hasOwnProperty(u);if(!o&&!this._plugins.hasOwnProperty(u))throw"No metaframe or plugin: ".concat(u);var l=o?e?this._state.metaframes.inputs:this._state.metaframes.outputs:e?this._state.plugins.inputs:this._state.plugins.outputs;if("string"==typeof i){l[u]=null!=l[u]?l[u]:{};var f=i;void 0===n?delete l[u][f]:l[u][f]=n}else{if("object"!==t(i))throw"Second argument must be a string or an object";l[u]=null!=l[u]?l[u]:{};var h=i;Object.keys(h).forEach(function(t){void 0===h[t]?delete l[u][t]:l[u][t]=h[t]})}}}},{key:"getMetaframeOrPlugin",value:function(t){var e=this._metaframes[t];return e||(e=this._plugins[t]),e}},{key:"onMessage",value:function(e){var s=this;if("object"===t(e.data)){var i=e.data;if(!this.isValidJSONRpcMessage(i))return void(this.debug&&this.log("invalid message ".concat(JSON.stringify(i).substr(0,200))));var n=i.method;switch(n){case b.JsonRpcMethodsFromChild.SetupIframeClientRequest:Object.keys(this._metaframes).forEach(function(t){s._metaframes[t].register()}),Object.keys(this._plugins).forEach(function(t){s._plugins[t].register()});break;case b.JsonRpcMethodsFromChild.SetupIframeServerResponseAck:var a=i.params;this.getMetaframeOrPlugin(i.iframeId).registered(a.version);break;case b.JsonRpcMethodsFromChild.OutputsUpdate:var r=i.iframeId,u=i.params;if(this.debug&&this.log("outputs ".concat(u," from ").concat(r)),this._metaframes[r]){var o=this._metaframes[r];this.setOutputStateOnly(r,u),o.setOutputs(u),this.emit(d.State,this._state);var l=!1;Object.keys(u).forEach(function(t){var e=s.getInputsFromOutput(r,t);e.length>0&&Object.keys(e).forEach(function(i){var n=e[i],a={};a[n.pipe]=u[t],s.setInputStateOnly(n.metaframe,n.pipe,u[t]),s._metaframes[n.metaframe].setInputs(a),l=!0})}),l&&this.emit(d.State,this._state),this.debug&&o.ack({jsonrpc:i,state:this._state})}else if(this._plugins[r]){var f=!u[y.METAPAGE_KEY_STATE]&&!u[y.METAPAGE_KEY_DEFINITION];f&&this.setOutputStateOnly(r,u),this._plugins[r].setOutputs(u),f&&this.emit(d.State,this._state),this.debug&&this._plugins[r].ack({jsonrpc:i,state:this._state})}else this.error("missing metaframe/plugin=$metaframeId");case b.JsonRpcMethodsFromChild.InputsUpdate:r=i.iframeId;var h=i.params;if(this.debug&&this.log("inputs ".concat(h," from ").concat(r)),this._metaframes[r]){switch(this.setInputStateOnly(r,h),this._metaframes[r].version){case I.Versions.V0_0_1:case I.Versions.V0_1_0:if(this._metaframes[r].emit(d.Inputs,h),this.isListeners(d.Inputs)){var c={};c[r]=h,this.emit(d.Inputs,c)}break;default:this._metaframes[r].setInputs(h)}this.emit(d.State,this._state),this.debug&&this._metaframes[r].ack({jsonrpc:i,state:this._state})}else if(this._plugins[r]){var p=!h[y.METAPAGE_KEY_STATE]&&!h[y.METAPAGE_KEY_DEFINITION];p&&this.setInputStateOnly(r,h),this._plugins[r].setInputs(h),p&&this.emit(d.State,this._state),this.debug&&this._plugins[r].ack({jsonrpc:i,state:this._state})}else console.error('InputsUpdate failed no metaframe or plugin id: "'.concat(r,'"')),this.error('InputsUpdate failed no metaframe or plugin id: "'.concat(r,'"'));case b.JsonRpcMethodsFromChild.PluginRequest:var m=i.iframeId;null!=this._plugins[m]&&this._plugins[m].hasPermissionsState()&&(this._plugins[m].setInput(y.METAPAGE_KEY_STATE,this._state),this.debug&&this._plugins[m].ack({jsonrpc:i,state:this._state}));default:this.debug&&this.log('Unknown RPC method: "'.concat(n,'"'))}this.emit(b.OtherEvents.Message,i)}}},{key:"logInternal",value:function(t,e,s){var i;s=null!=s?s:this._consoleBackgroundColor,i="string"==typeof t?t:"number"==typeof t?t+"":JSON.stringify(t),i=null!=this._id?"Metapage[".concat(this._id,"] ").concat(i):i,k.log(i,e,s)}}],[{key:"from",value:function(t,e){if(null==t)throw"Metapage definition cannot be null";if("string"==typeof t)try{t=JSON.parse(t)}catch(s){throw"Cannot parse into JSON:\n${metaPageDef}"}return(new u).setDefinition(t)}}]),u}();exports.Metapage=O,O.version=y.VERSION,O.DEFINITION=d.Definition,O.INPUTS=d.Inputs,O.OUTPUTS=d.Outputs,O.STATE=d.State,O.ERROR=d.Error;var w=function(t){r(a,_.EventEmitter);var s=o(a);function a(t,i,n,r){var u,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e(this,a),(u=s.call(this)).inputs={},u.outputs={},u._disposables=[],u._rpcListeners=[],u._loaded=!1,u._onLoaded=[],u._sendInputsAfterRegistration=!1,u._cachedEventInputsUpdate={iframeId:null,inputs:null},u._cachedEventOutputsUpdate={iframeId:null,inputs:null},!t.startsWith("http")){for(;t.startsWith("/");)t=t.substr(1);t=location.protocol+"//"+location.hostname+(null!=location.port&&""!=location.port?":"+location.port:"")+"/"+t}u.url=t;var l=new URL(u.url);return o&&l.searchParams.set(y.URL_PARAM_DEBUG,"1"),u.url=l.href,u.id=i,u.iframe=document.createElement("iframe"),u.iframe.src=u.url,u._debug=o||k.existsAnyUrlParam(["DEBUG_METAFRAMES","debug_metaframes","debug_"+u.id,"DEBUG_"+u.id]),u.iframe.frameBorder="0",u._parentId=n,u._color=k.stringToRgb(u.id),u._consoleBackgroundColor=r,u}return i(a,[{key:"setPlugin",value:function(){if(this._loaded)throw"Cannot setPlugin after IFrameRpcClient already loaded";return this._plugin=!0,this.bindPlugin(),this}},{key:"setMetapage",value:function(t){return this._metapage=t,this}},{key:"bindPlugin",value:function(){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,s,i,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getDefinition();case 3:e=t.sent,this.hasPermissionsDefinition()&&(s=this._metapage.addEventListener(d.Definition,function(t){n.setInput(y.METAPAGE_KEY_DEFINITION,t.definition)}),this._disposables.push(s),i=this._metapage.getDefinition(),this.setInput(y.METAPAGE_KEY_DEFINITION,i),e.outputs&&(s=this.onOutput(y.METAPAGE_KEY_DEFINITION,function(t){n._metapage.setDefinition(t)}),this._disposables.push(s))),this.hasPermissionsState()&&null!=e.outputs&&(s=this.onOutput(y.METAPAGE_KEY_STATE,function(t){n._metapage.setState(t)}),this._disposables.push(s)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this._metapage.emit(d.Error,'Failed to get plugin definition from "'.concat(this.getDefinitionUrl(),'", error=').concat(t.t0));case 11:case"end":return t.stop()}},t,this,[[0,8]])}))}},{key:"hasPermissionsState",value:function(){return null!=this._definition&&null!=this._definition.inputs[y.METAPAGE_KEY_STATE]}},{key:"hasPermissionsDefinition",value:function(){return null!=this._definition&&null!=this._definition.inputs[y.METAPAGE_KEY_DEFINITION]}},{key:"getDefinitionUrl",value:function(){var t=new URL(this.url);return t.pathname=t.pathname+(t.pathname.endsWith("/")?"metaframe.json":"/metaframe.json"),t.href}},{key:"getDefinition",value:function(){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,s,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this._definition){t.next=2;break}return t.abrupt("return",this._definition);case 2:return e=this.getDefinitionUrl(),t.next=5,window.fetch(e);case 5:return s=t.sent,t.next=8,s.json();case 8:return i=t.sent,this._definition=i,t.abrupt("return",i);case 11:case"end":return t.stop()}},t,this)}))}},{key:"setInput",value:function(t,e){console.assert(null!=t);var s={};s.set(t,e),this.setInputs(s)}},{key:"setInputs",value:function(t){if(!this.inputs.merge(t))return this;if(this._loaded||(this._sendInputsAfterRegistration=!0),null!=this.iframe.parentNode&&this._loaded&&this.sendInputs(t),this.emit(d.Inputs,this.inputs),this._metapage.isListeners(d.Inputs)){var e={};e[this.id]=t,this._metapage.emit(d.Inputs,e)}return this._cachedEventInputsUpdate.iframeId=this.id,this._cachedEventInputsUpdate.inputs=this.inputs,this._metapage.emit(b.JsonRpcMethodsFromParent.InputsUpdate,this._cachedEventInputsUpdate),this}},{key:"setOutput",value:function(t,e){console.assert(null!=t);var s={};s.set(t,e),this.setOutputs(s)}},{key:"setOutputs",value:function(t){if(this.outputs.merge(t)&&(this.emit(d.Outputs,t),this._metapage.isListeners(d.Outputs))){var e={};e[this.id]=this.outputs,this._metapage.emit(d.Outputs,e)}}},{key:"onInputs",value:function(t){return this.on(d.Inputs,t)}},{key:"onInput",value:function(t,e){return this.on(d.Inputs,function(s){s.exists(t)&&e(s[t])})}},{key:"onOutputs",value:function(t){return this.on(d.Outputs,t)}},{key:"onOutput",value:function(t,e){return this.on(d.Outputs,function(s){s.exists(t)&&e(s[t])})}},{key:"dispose",value:function(){for(n(c(a.prototype),"dispose",this).call(this);null!=this._disposables&&this._disposables.length>0;)this._disposables.pop()();this._rpcListeners=null,this.inputs=null,this.outputs=null,this._ready=null,null!=this.iframe&&null!=this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,this._bufferMessages=null,null!=this._bufferTimeout&&(window.clearInterval(this._bufferTimeout),this._bufferTimeout=null),this._metapage=null}},{key:"register",value:function(){if(!this._loaded){var t={iframeId:this.id,parentId:this._parentId,plugin:this._plugin,state:{inputs:this.inputs},version:O.version};this.sendRpcInternal(b.JsonRpcMethodsFromParent.SetupIframeServerResponse,t)}}},{key:"registered",value:function(t){if(!this._loaded){for(this.version=t,null==this.version&&(this.version=I.Versions.V0_1_0),this._loaded=!0;null!=this._onLoaded&&this._onLoaded.length>0;)this._onLoaded.pop()();this._sendInputsAfterRegistration&&this.sendInputs(this.inputs)}}},{key:"sendInputs",value:function(t){this.sendRpc(b.JsonRpcMethodsFromParent.InputsUpdate,{inputs:t,parentId:this._parentId})}},{key:"sendRpc",value:function(t,e){null!=this.iframe.parentNode&&this._loaded?this.sendRpcInternal(t,e):(this._metapage.error("sending rpc later"),this._onLoaded.push(function(){this.sendRpcInternal(t,e)}))}},{key:"ack",value:function(t){if(this.log("⚒ ⚒ ⚒ calling ack"),this._debug){this.log("⚒ ⚒ ⚒ sending ack from client to frame");var e={message:t};this.sendRpc(b.JsonRpcMethodsFromParent.MessageAck,e)}else this.log("⚒ ⚒ ⚒ NOT sending ack from client to frame since not debug mode")}},{key:"log",value:function(t){this._debug&&this.logInternal(t)}},{key:"logInternal",value:function(t){var e;e="string"==typeof t?t:"string"==typeof t?t+"":JSON.stringify(t),k.log("Metapage[".concat(this._parentId,"] Metaframe[$id] ").concat(e),this._color,this._consoleBackgroundColor)}},{key:"sendRpcInternal",value:function(t,e){var s={id:"_",iframeId:this.id,jsonrpc:"2.0",method:t,params:e,parentId:this._parentId};null!=this.iframe?this.sendOrBufferPostMessage(s):this._metapage.error("Cannot send to child iframe messageJSON=${JSON.stringify(messageJSON).substr(0, 200)}")}},{key:"sendOrBufferPostMessage",value:function(t){null!=this.iframe.contentWindow?this.iframe.contentWindow.postMessage(t,this.url):null==this._bufferMessages?(this._bufferMessages=[t],this._bufferTimeout=window.setInterval(function(){var t=this;null!=this.iframe.contentWindow&&(this._bufferMessages.forEach(function(e){return t.iframe.contentWindow.postMessage(e,t.url)}),window.clearInterval(this._bufferTimeout),this._bufferTimeout=null,this._bufferMessages=null)},0)):this._bufferMessages.push(t)}}]),a}();
},{"./EventEmitter":"yQaM","minimatch":"N4jv","../Constants":"wx8G","../MetaLibsVersion":"ckaR","../v0_3/JsonRpcMethods":"jmpc","./MetapageTools":"f0H1"}]},{},["Vntl"], null)
//# sourceMappingURL=/Metapage.js.map